let dropArea=document.getElementById("drop-area"),fileInput=document.getElementById("fileElem"),uploadedImages=document.getElementById("uploaded-images");function handleDrop(e){dropArea.classList.remove("dragover"),handleUpload(e.dataTransfer.files)}function handleFiles(e){handleUpload(e.target.files)}async function handleUpload(e){uploadedImages.innerHTML='<label for="upload-url">Current Upload</label>';e=[...e].map(async a=>{if(5242880<a.size)return alert(`File "${a.name}" exceeds 5MB limit.`),null;var e=new FormData;e.append("file",a);try{var t,r,d,o,n,l=await fetch("/upload",{method:"POST",body:e});if(l.ok)return t=await l.json(),r=document.createElement("div"),d=window.location.host,r.className="preview",r.innerHTML=`
<input type="text" value="http://${d}${t.url}" readonly />
<button onclick="copyToClipboard(this)">COPY</button>
`,(o=document.createElement("a")).setAttribute("href",t.url),(n=document.createElement("img")).src=URL.createObjectURL(a),o.appendChild(n),r.appendChild(o),uploadedImages.appendChild(r),t.url;{let e;try{e=await l.json()}catch{throw new Error(`Upload failed for ${a.name} with status `+l.status)}throw new Error(e.detail||"Upload failed for "+a.name)}}catch(e){return alert(e.message),null}});await Promise.all(e)}function copyToClipboard(e){var e=e.closest(".preview");e&&(e=e.querySelector('input[type="text"]'))&&(e.select(),document.execCommand("copy"),alert("Copied to clipboard!"))}["dragenter","dragover","dragleave","drop"].forEach(e=>{dropArea.addEventListener(e,e=>e.preventDefault(),!1),dropArea.addEventListener(e,e=>e.stopPropagation(),!1)}),dropArea.addEventListener("dragover",()=>dropArea.classList.add("dragover")),dropArea.addEventListener("dragleave",()=>dropArea.classList.remove("dragover")),dropArea.addEventListener("drop",handleDrop),fileInput.addEventListener("change",handleFiles);